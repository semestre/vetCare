import{a as U}from"./chunk-2XMMWKXJ.js";import{$a as se,A as u,Aa as K,Ab as ke,B as C,Ca as Q,D as r,Da as X,Db as Se,E as L,Ea as Z,Eb as T,F as v,Fa as $,Fb as E,Gb as A,H as D,Ha as ee,I as V,Ia as te,J as R,Ja as oe,K as H,O as Y,P as J,Q as M,Qa as y,Ra as k,S as P,Ta as S,Va as ne,Wa as ie,Xa as re,Ya as ae,Za as le,ab as ce,b as B,bb as de,cb as me,db as I,e as f,fb as pe,gb as ge,h as F,hb as ue,i as z,ib as fe,mb as he,n as s,nb as be,ob as _e,p as w,pb as Ce,q as _,qb as xe,rb as we,s as G,sb as ve,t as p,tb as Me,u as e,ub as Pe,v as t,vb as Oe,w as m,x as W,y as q,ya as x,z as N,za as O,zb as ye}from"./chunk-BD74CAZO.js";import{a as j,e as b}from"./chunk-JHI3MBHO.js";function ze(a,l){a&1&&(e(0,"ion-note",24),r(1," Debe tener al menos 3 caracteres. "),t())}function Ne(a,l){a&1&&(e(0,"ion-note",24),r(1," La contrase\xF1a es obligatoria (m\xEDnimo 4). "),t())}var Ie=(()=>{let l=class l{constructor(){this.fb=f(ee),this.modalCtrl=f(T),this.service=f(U),this.toast=f(E),this.loading=f(Se),this.form=this.fb.group({nombreUsuario:["",[x.required,x.minLength(3)]],password:["",[x.required,x.minLength(4)]],rol:["Veterinario",x.required]}),this.showPass=!1}close(){this.modalCtrl.dismiss(null,"cancel")}save(){return b(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),(yield this.toast.create({message:"Revisa los campos obligatorios.",duration:1800,color:"warning",icon:"alert-circle-outline",position:"top"})).present();return}let n=yield this.loading.create({message:"Creando usuario..."});yield n.present();let{nombreUsuario:i,password:o,rol:c}=this.form.value,d={idUsuario:0,nombreUsuario:String(i),password:String(o),rol:String(c)};this.service.createUsuario(d).pipe(B(1)).subscribe({next:h=>b(this,null,function*(){try{yield n.dismiss()}catch{}(yield this.toast.create({message:"Usuario creado",duration:1500,color:"success",icon:"checkmark-circle-outline",position:"top"})).present(),this.modalCtrl.dismiss(!0,"created")}),error:h=>b(this,null,function*(){try{yield n.dismiss()}catch{}console.error("createUsuario error:",{status:h?.status,body:h?.error});let Te=typeof h?.error=="string"&&h.error.length<160?h.error:"No se pudo crear el usuario.";(yield this.toast.create({message:Te,duration:2500,color:"danger",icon:"close-circle-outline",position:"top",buttons:[{text:"Cerrar",role:"cancel"}]})).present()})})})}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=w({type:l,selectors:[["app-control-usuario-modal"]],decls:35,vars:5,consts:[[1,"dialog"],[1,"dialog-header"],["fill","clear","aria-label","Cerrar","size","small",3,"click"],["name","close-outline","slot","icon-only"],[1,"dialog-body"],["novalidate","",1,"form-body",3,"ngSubmit","formGroup"],["inset","true",1,"group"],["name","person-outline","slot","start"],["label","Nombre de usuario","labelPlacement","stacked","placeholder","ej. admin, vet.juan","formControlName","nombreUsuario"],["color","danger",4,"ngIf"],["name","lock-closed-outline","slot","start"],["label","Contrase\xF1a","labelPlacement","stacked","placeholder","M\xEDnimo 4 caracteres","formControlName","password",3,"type"],["fill","clear","slot","end","aria-label","Mostrar/ocultar contrase\xF1a",3,"click"],[3,"name"],["name","ribbon-outline","slot","start"],["label","Rol","labelPlacement","stacked","formControlName","rol","interface","popover"],["value","Administrador"],["value","Veterinario"],["value","Asistente"],[1,"bottom-space"],[1,"dialog-footer"],["fill","outline","color","medium",3,"click"],["type","submit",3,"click"],["slot","start","name","save-outline"],["color","danger"]],template:function(i,o){if(i&1&&(e(0,"div",0)(1,"div",1)(2,"h2"),r(3,"Nuevo usuario"),t(),e(4,"ion-button",2),u("click",function(){return o.close()}),m(5,"ion-icon",3),t()(),e(6,"div",4)(7,"form",5),u("ngSubmit",function(){return o.save()}),e(8,"ion-list",6)(9,"ion-item"),m(10,"ion-icon",7)(11,"ion-input",8),t(),_(12,ze,2,0,"ion-note",9),e(13,"ion-item"),m(14,"ion-icon",10)(15,"ion-input",11),e(16,"ion-button",12),u("click",function(){return o.showPass=!o.showPass}),m(17,"ion-icon",13),t()(),_(18,Ne,2,0,"ion-note",9),e(19,"ion-item"),m(20,"ion-icon",14),e(21,"ion-select",15)(22,"ion-select-option",16),r(23,"Administrador"),t(),e(24,"ion-select-option",17),r(25,"Veterinario"),t(),e(26,"ion-select-option",18),r(27,"Recepcionista"),t()()()(),m(28,"div",19),t()(),e(29,"div",20)(30,"ion-button",21),u("click",function(){return o.close()}),r(31,"Cancelar"),t(),e(32,"ion-button",22),u("click",function(){return o.save()}),m(33,"ion-icon",23),r(34," Guardar "),t()()()),i&2){let c,d;s(7),p("formGroup",o.form),s(5),p("ngIf",((c=o.form.get("nombreUsuario"))==null?null:c.touched)&&((c=o.form.get("nombreUsuario"))==null?null:c.invalid)),s(3),p("type",o.showPass?"text":"password"),s(2),p("name",o.showPass?"eye-off-outline":"eye-outline"),s(),p("ngIf",((d=o.form.get("password"))==null?null:d.touched)&&((d=o.form.get("password"))==null?null:d.invalid))}},dependencies:[P,M,A,S,I,pe,ge,fe,he,Me,Pe,y,k,oe,X,O,K,Z,$],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:only light}.dialog[_ngcontent-%COMP%]{width:min(720px,92vw);max-height:min(88vh,90dvh);background:#fff;border-radius:20px;box-shadow:0 20px 60px #0f172a40;border:1px solid rgba(226,232,240,.8);display:grid;grid-template-rows:auto 1fr auto;overflow:hidden}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#fff;border-bottom:1px solid rgba(0,0,0,.08)}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:700;color:#0f172a}.dialog-body[_ngcontent-%COMP%]{min-height:0;overflow:auto;padding:14px}.dialog-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 14px;background:#fff;border-top:1px solid rgba(0,0,0,.08)}.dialog-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius:9999px;text-transform:uppercase;font-weight:600}.dialog-footer[_ngcontent-%COMP%]   ion-button[color=medium][_ngcontent-%COMP%]{--background:transparent;--color:#475569;border:1px solid #cbd5e1}.dialog[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{background:transparent!important;padding:0;margin:0 0 10px}.dialog[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background:#f9fbff;--color:#0f172a;--border-color:#e6edf5;--inner-border-width:0;--padding-start:12px;--inner-padding-end:12px;margin:10px 0}.dialog[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]::part(native){border:1px solid #e6edf5;border-radius:14px;overflow:hidden}.dialog[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], .dialog[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], .dialog[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--color:#0f172a;--placeholder-color:#64748b;--highlight-color-focused:#3b82f6;--highlight-color-valid:#3b82f6;--highlight-color-invalid:#ef4444}.dialog[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(label), .dialog[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(label), .dialog[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(label){color:#6b7280;font-weight:600}.dialog[_ngcontent-%COMP%]   ion-icon[slot=start][_ngcontent-%COMP%]{color:#2193b0;margin-inline-end:8px}@media (max-width: 420px){.dialog[_ngcontent-%COMP%]{width:96vw;max-height:min(92vh,94dvh);border-radius:14px}}']});let a=l;return a})();var Le=()=>[1,2,3,4,5,6];function De(a,l){a&1&&(e(0,"ion-col",25)(1,"ion-card",26)(2,"ion-card-header",27),m(3,"div",28),e(4,"div",29),m(5,"ion-skeleton-text",30)(6,"ion-skeleton-text",31),t()(),e(7,"ion-card-content"),m(8,"ion-skeleton-text",32)(9,"ion-skeleton-text",33),t()()())}function Ve(a,l){a&1&&(W(0),e(1,"ion-grid",23)(2,"ion-row"),_(3,De,10,0,"ion-col",24),t()(),q()),a&2&&(s(3),p("ngForOf",H(1,Le)))}function Re(a,l){if(a&1){let g=N();e(0,"ion-card",34)(1,"ion-card-header")(2,"ion-card-title"),r(3,"Ups"),t(),e(4,"ion-card-subtitle"),r(5),t()(),e(6,"ion-card-content")(7,"ion-button",35),u("click",function(){F(g);let i=C();return z(i.load())}),r(8,"Reintentar"),t()()()}if(a&2){let g=C();s(5),L(g.error)}}function je(a,l){if(a&1){let g=N();e(0,"div",36)(1,"div",37),r(2,"\u{1F9D1}\u200D\u2695\uFE0F"),t(),e(3,"h3"),r(4,"Sin usuarios"),t(),e(5,"p"),r(6,"Agrega tu primer usuario para comenzar."),t(),e(7,"ion-button",38),u("click",function(){F(g);let i=C();return z(i.nuevoUsuario())}),r(8,"Nuevo usuario"),t()()}}function Be(a,l){if(a&1&&(e(0,"ion-col",25)(1,"div",39)(2,"div",40),m(3,"ion-icon",41),t(),e(4,"ion-card",42)(5,"ion-card-header",27)(6,"div",43),r(7),t(),e(8,"div",44)(9,"ion-card-title",45),r(10),t()()(),e(11,"ion-card-content")(12,"div",46)(13,"div",47)(14,"span",48),r(15,"ID:"),t(),e(16,"span",49),r(17),t()(),e(18,"div",47)(19,"span",48),r(20,"Contrase\xF1a:"),t(),e(21,"span",49),r(22),t()()(),e(23,"div",50),r(24," Por seguridad no se muestran contrase\xF1as en texto plano. "),t()()()()()),a&2){let g=l.$implicit,n=l.index,i=C(2);s(2),p("ngClass","color-"+(n%4+1)),s(4),G("aria-label",g.rol||"usuario"),s(),v(" ",i.roleEmoji(g.rol)||i.initial(g.nombreUsuario)," "),s(3),L(g.nombreUsuario),s(7),v("#",g.idUsuario),s(5),v("#",g.password)}}function Ge(a,l){if(a&1&&(e(0,"ion-grid",23)(1,"ion-row"),_(2,Be,25,6,"ion-col",24),t()()),a&2){let g=C();s(2),p("ngForOf",g.filteredUsuarios)}}var at=(()=>{let l=class l{constructor(){this.controlAccesoService=f(U),this.toast=f(E),this.modalCtrl=f(T),this.usuarios=[],this.fallback=[{idUsuario:1,nombreUsuario:"admin",password:"\u2022\u2022\u2022\u2022",rol:"Administrador"},{idUsuario:2,nombreUsuario:"veterinario01",password:"\u2022\u2022\u2022\u2022",rol:"Veterinario"}],this.loading=!0,this.error=null,this._searchTerm="",this._rol="Todos",this.filteredUsuarios=[]}get searchTerm(){return this._searchTerm}set searchTerm(n){this._searchTerm=(n||"").trim(),this.applyFilters()}get rol(){return this._rol}set rol(n){this._rol=n||"Todos",this.applyFilters()}ngOnInit(){this.load()}load(n){this.loading=!n,this.error=null,this.controlAccesoService.getAllUsuarios().subscribe({next:i=>{this.usuarios=(Array.isArray(i)?i:[]).map(o=>j({},o)),this.usuarios.length||(this.usuarios=this.fallback),this.applyFilters(),this.loading=!1,n?.detail.complete()},error:i=>b(this,null,function*(){console.error("Error al cargar los usuarios:",i),this.error="No se pudieron cargar los usuarios.",this.usuarios=this.fallback,this.applyFilters(),this.loading=!1,n?.detail.complete(),(yield this.toast.create({message:"No se pudieron cargar los usuarios.",duration:1800,color:"danger"})).present()})})}normalize(n){return(n??"").toString().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")}applyFilters(){let n=this.normalize(this.searchTerm),i=this.normalize(this.rol);this.filteredUsuarios=(this.usuarios||[]).filter(o=>{let c=this.normalize(o.rol),d=i===this.normalize("Todos")?!0:c===i||c.includes(i),h=!n||this.normalize(o.nombreUsuario).includes(n)||c.includes(n)||this.normalize(o.idUsuario).includes(n);return d&&h})}nuevoUsuario(){return b(this,null,function*(){let n=yield this.modalCtrl.create({component:Ie,cssClass:"center-modal",mode:"md",backdropDismiss:!1,animated:!0});yield n.present();let{role:i}=yield n.onDidDismiss();i==="created"&&this.load()})}initial(n){return(n?.trim()?.charAt(0)||"?").toUpperCase()}roleEmoji(n){let i=(n||"").toLowerCase().trim();return i.includes("admin")?"\u{1F451}":i.includes("vet")?"\u{1F43E}":i.includes("asis")?"\u{1F9D1}\u200D\u{1F4BC}":""}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=w({type:l,selectors:[["app-lista-control-acceso"]],decls:33,vars:7,consts:[[1,"header-white"],["color","transparent"],[1,"header-row"],[1,"title"],["name","shield-checkmark-outline","aria-hidden","true"],["placeholder","Buscar por nombre, rol o ID...","show-clear-button","focus","animated","true",3,"ngModelChange","ngModel"],[1,"ion-padding","content-bg",3,"fullscreen"],[1,"controls","container"],[1,"filters"],["value","Todos","mode","md",3,"ngModelChange","ngModel"],["value","Todos"],["value","Administrador"],["value","Veterinario"],["value","Asistente"],[1,"actions"],["fill","solid","color","primary",3,"click"],["slot","start","name","add-outline"],["slot","fixed",3,"ionRefresh"],["pullingText","Desliza para refrescar"],[4,"ngIf"],["class","card error-card",4,"ngIf"],["class","empty",4,"ngIf"],["fixed","",4,"ngIf"],["fixed",""],["size","12","size-md","6","size-lg","4",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","4"],[1,"card","glass"],[1,"card-header"],[1,"avatar","sk"],[1,"sk-lines"],["animated","",2,"width","70%"],["animated","",2,"width","40%"],["animated","",2,"width","90%"],["animated","",2,"width","60%"],[1,"card","error-card"],["fill","outline",3,"click"],[1,"empty"],[1,"emoji"],[3,"click"],[1,"card-wrap"],[1,"card-badge",3,"ngClass"],["name","person-outline"],[1,"card","glass","hover"],[1,"avatar"],[1,"title-wrap"],[1,"name"],[1,"meta"],[1,"meta-item"],[1,"meta-k"],[1,"meta-v"],[1,"note"]],template:function(i,o){i&1&&(e(0,"ion-header",0)(1,"ion-toolbar",1)(2,"div",2)(3,"ion-title",3),m(4,"ion-icon",4),r(5," Usuarios "),t(),e(6,"ion-searchbar",5),R("ngModelChange",function(d){return V(o.searchTerm,d)||(o.searchTerm=d),d}),t()()()(),e(7,"ion-content",6)(8,"div",7)(9,"div",8)(10,"ion-segment",9),R("ngModelChange",function(d){return V(o.rol,d)||(o.rol=d),d}),e(11,"ion-segment-button",10)(12,"ion-label"),r(13,"Todos"),t()(),e(14,"ion-segment-button",11)(15,"ion-label"),r(16,"Administrador"),t()(),e(17,"ion-segment-button",12)(18,"ion-label"),r(19,"Veterinario"),t()(),e(20,"ion-segment-button",13)(21,"ion-label"),r(22,"Asistente"),t()()()(),e(23,"div",14)(24,"ion-button",15),u("click",function(){return o.nuevoUsuario()}),m(25,"ion-icon",16),r(26," Nuevo usuario "),t()()(),e(27,"ion-refresher",17),u("ionRefresh",function(d){return o.load(d)}),m(28,"ion-refresher-content",18),t(),_(29,Ve,4,2,"ng-container",19)(30,Re,9,1,"ion-card",20)(31,je,9,0,"div",21)(32,Ge,3,1,"ion-grid",22),t()),i&2&&(s(6),D("ngModel",o.searchTerm),s(),p("fullscreen",!0),s(3),D("ngModel",o.rol),s(19),p("ngIf",o.loading),s(),p("ngIf",!o.loading&&o.error),s(),p("ngIf",!o.loading&&!o.filteredUsuarios.length),s(),p("ngIf",!o.loading&&o.filteredUsuarios.length))},dependencies:[A,S,ne,ie,re,ae,le,se,ce,de,me,I,ue,be,_e,Ce,xe,we,ve,Oe,ye,ke,y,k,P,Y,J,M,te,O,Q],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:only light;--ion-background-color:#fff;--ion-text-color:#0f172a;--accent:#2193b0;--btn-blue:#3b82f6;--btn-blue-hover:#2563eb;--soft-border:1px solid rgba(226,232,240,.9);--card-shadow:0 12px 28px rgba(2,6,23,.08)}.header-white[_ngcontent-%COMP%]{background:#fff!important;box-shadow:0 2px 8px #0f172a0f;border-bottom:1px solid rgba(0,0,0,.05);z-index:20;margin-top:var(--outer-header-height, 55px)}.header-white[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:#fff !important}.header-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 12px}.title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:800;color:#1e293b}.title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--accent);font-size:1.2rem}.header-row[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{flex:1;max-width:560px;height:44px;--background:#fff;--color:#0f172a;--placeholder-color:#64748b;--icon-color:#64748b;border:none}.header-row[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]::part(container){border-radius:999px;border:1px solid rgba(226,232,240,.9);box-shadow:none;background:#fff;padding-inline:12px}.controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 12px 14px}.controls[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{flex:1;min-width:0}.controls[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-shrink:0}ion-segment[_ngcontent-%COMP%]{background:#f3f7fb;border-radius:999px;padding:4px;box-shadow:none;border:0}ion-segment-button[_ngcontent-%COMP%]{--indicator-color:#fff;--color:#0f172a;--color-checked:#0f172a;--background:transparent;--background-checked:#fff;border-radius:999px}.controls[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius:9999px;--box-shadow:none;--background:var(--btn-blue);--background-hover:var(--btn-blue-hover);--color:#fff;height:42px;min-width:140px;padding:0 22px;white-space:nowrap;font-weight:700;letter-spacing:.3px;display:flex;align-items:center;justify-content:center}.content-bg[_ngcontent-%COMP%]{--background:linear-gradient(180deg,#f7fbff 0%,#fff 100%)}.card[_ngcontent-%COMP%]{background:#fff;border:var(--soft-border);border-radius:18px;box-shadow:var(--card-shadow);overflow:hidden;transition:transform .2s,box-shadow .2s}.card.hover[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 16px 32px #0206171f}.card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:14px 16px}.avatar[_ngcontent-%COMP%]{width:84px;height:84px;border-radius:50%;background:linear-gradient(135deg,#e3f6fd,#dbeafe);color:#0f172a;font-weight:800;display:grid;place-items:center;border:3px solid #fff;box-shadow:0 6px 14px #0206171a}.avatar.sk[_ngcontent-%COMP%]{background:#eef2f7;border:0;box-shadow:none}.title-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-width:0}.name[_ngcontent-%COMP%]{color:#1f2a44;font-weight:800;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-weight:600;font-size:.85rem;background:#eef7ff;color:#1e3a8a;border:1px solid #dbe9ff}.role-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.meta[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.75rem;margin-top:.25rem}.meta-item[_ngcontent-%COMP%]{background:#f7fafc;border:1px solid #e6edf5;border-radius:12px;padding:.7rem .9rem}.meta-k[_ngcontent-%COMP%]{display:block;font-size:.8rem;color:#64748b;margin-bottom:.15rem}.meta-v[_ngcontent-%COMP%]{font-weight:700;color:#0f172a}.note[_ngcontent-%COMP%]{margin-top:.6rem;font-size:.85rem;color:#64748b}@media (max-width: 480px){.header-row[_ngcontent-%COMP%]{flex-wrap:wrap}.controls[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding-left:8px}}.header-row[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{flex:1;max-width:560px;height:44px;--background: #ffffff !important;--color: #0f172a !important;--placeholder-color: #64748b !important;--icon-color: #64748b !important;--clear-button-color: #64748b !important;border:none!important}.header-row[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]::part(container){border-radius:999px!important;border:1px solid rgba(226,232,240,.9)!important;box-shadow:none!important;background:#fff!important;padding-inline:12px!important}[_nghost-%COMP%]     .header-row ion-searchbar .searchbar-input-container, [_nghost-%COMP%]     .header-row ion-searchbar .searchbar-input{border-radius:999px!important}']});let a=l;return a})();export{at as a};
