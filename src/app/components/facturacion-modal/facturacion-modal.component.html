<!-- Diálogo centrado (no usamos ion-header/footer para evitar “sheet”) -->
<div class="dialog">

  <!-- Header -->
  <div class="dialog-header">
    <h2>Nueva factura</h2>
    <ion-button (click)="close()" fill="clear" aria-label="Cerrar" size="small">
      <ion-icon slot="icon-only" name="close-outline"></ion-icon>
    </ion-button>
  </div>

  <!-- Body (scrollable) -->
  <div class="dialog-body">
    <form [formGroup]="form" (ngSubmit)="save()" class="form-body" novalidate>

      <ion-list inset="true" class="group">
        <ion-item>
          <ion-icon name="paw-outline" slot="start"></ion-icon>
          <ion-label position="stacked">Paciente</ion-label>
          <ion-select formControlName="idPaciente" placeholder="Selecciona un paciente">
            <ion-select-option *ngFor="let p of pacientes" [value]="p.idPaciente">
              {{ p.idPaciente }} - {{ p.nombreMascota }}
            </ion-select-option>
          </ion-select>
        </ion-item>
        <ion-note color="danger" *ngIf="form.get('idPaciente')?.touched && form.get('idPaciente')?.invalid">
          Ingresa un paciente válido.
        </ion-note>

        <ion-item>
          <ion-icon name="medkit-outline" slot="start"></ion-icon>
          <ion-textarea
            label="Servicios"
            labelPlacement="stacked"
            auto-grow="true"
            placeholder="Consulta, cirugía, etc."
            formControlName="servicios">
          </ion-textarea>
        </ion-item>
        <ion-note color="danger" *ngIf="form.get('servicios')?.touched && form.get('servicios')?.invalid">
          Escribe al menos 3 caracteres.
        </ion-note>

        <ion-item>
          <ion-icon name="flask-outline" slot="start"></ion-icon>
          <ion-textarea
            label="Medicamentos"
            labelPlacement="stacked"
            auto-grow="true"
            placeholder="Vacunas, anestesia, etc."
            formControlName="medicamentos">
          </ion-textarea>
        </ion-item>
      </ion-list>

      <ion-list inset="true" class="group">
        <ion-item>
          <ion-icon name="pricetag-outline" slot="start"></ion-icon>
          <ion-input
            type="number"
            step="0.01"
            inputmode="decimal"
            label="Total"
            labelPlacement="stacked"
            formControlName="total">
          </ion-input>
        </ion-item>
        <ion-note color="danger" *ngIf="form.get('total')?.touched && form.get('total')?.invalid">
          Ingresa un monto válido.
        </ion-note>

        <ion-item>
          <ion-icon name="calendar-outline" slot="start"></ion-icon>
          <ion-input
            type="date"
            label="Fecha"
            labelPlacement="stacked"
            formControlName="fecha">
          </ion-input>
        </ion-item>
        <ion-note color="danger" *ngIf="form.get('fecha')?.touched && form.get('fecha')?.invalid">
          La fecha es obligatoria.
        </ion-note>

        <ion-item>
          <ion-icon name="card-outline" slot="start"></ion-icon>
          <ion-select
            label="Método de pago"
            labelPlacement="stacked"
            formControlName="metodoPago"
            interface="popover">
            <ion-select-option value="Efectivo">Efectivo</ion-select-option>
            <ion-select-option value="Tarjeta">Tarjeta</ion-select-option>
            <ion-select-option value="Transferencia">Transferencia</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>

      <div class="bottom-space"></div>
    </form>
  </div>

  <!-- Footer fijo -->
  <div class="dialog-footer">
    <ion-button fill="outline" color="medium" (click)="close()">Cancelar</ion-button>
    <ion-button type="submit" (click)="save()">
      <ion-icon slot="start" name="save-outline"></ion-icon>
      Guardar
    </ion-button>
  </div>

</div>
